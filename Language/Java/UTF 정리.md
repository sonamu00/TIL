## UTF란
- 전 세계 모든 문자의 **고유 번호(유니코드)**를 컴퓨터가 이해할 수 있는 실제 데이터(0과 1)로 변환하는 표준 규칙

### 유니코드
- 전 세계 모든 문자를 어떤 컴퓨터 환경에서도 통일되게 표현할 수 있도록 글자마다 부여한 고유한 숫자 번호 체계
- 유니코드의 코드포인트(개별 번호)는 문자마다 식별 번호만 부여해서 컴퓨터가 해석할 줄은 모름
	=> 유니코드를 컴퓨터에 저장하기 위해 변환하는 방식이 필요해서 UTF 등장

### UTF 종류
| **종류**     | **길이 방식**        | **한글 크기** | **특징 및 장단점**                           | **주요 사용처**                 |
| ---------- | ---------------- | --------- | -------------------------------------- | -------------------------- |
| **UTF-8**  | **가변** (1~4B)    | **3바이트**  | 영어는 1B로 절약, ASCII와 100% 호환, 전송에 가장 안전함 | **웹 표준**, 파일 저장, API 통신    |
| **UTF-16** | **가변** (2 or 4B) | **2바이트**  | 한글 등 아시아 언어 저장에 효율적, 영어도 2B라 서구권엔 비효율  | **자바 메모리**, 윈도우 내부, DB 인덱스 |
| **UTF-32** | **고정** (4B)      | **4바이트**  | 계산이 매우 단순하고 빠르나, 메모리 낭비가 매우 심함         | 특수 문자 처리, 텍스트 분석 알고리즘      |

## 자바의 인코딩 방식
- 모든 문자열을 UTF-16 BE(Big Endian) 으로 저장함 => 모든 글자를 2바이트 or 4바이트 크기로 저장한다는 말
- 자바가 실행되어 메모리에 올라가는 순간 모든 문자는 **UTF-16**으로 통일
	- 인코딩 방식 지정한 것은 메모리에 있는 UTF-16 데이터를 파일로 쓰거나 네트워크로 보낼 때, 사용자가 지정한 인코딩(예: UTF-8, EUC-KR)으로 **다시 인코딩하여 내보내는 것**

### 자바의 변형된 UTF-8
-  표준 UTF-8을 자바가 일부 포맷에서 변형해서 쓰는 **자바 전용 UTF-8 변형 규칙**
- 주로 쓰는 곳
	- `DataInputStream.readUTF()` / `DataOutputStream.writeUTF()` (바이너리 스트림용 문자열 포맷)
	- `.class` 파일 내부 문자열(상수풀 등)
	- JNI 같은 JVM 네이티브 인터페이스에서 종종 등장
- 표준 UTF-8과 다른 점 2가지
	1. **U+0000(NULL)** 코드를 UTF-8에서 쓰지 않는 임의에 값으로 변형해서 씀
	    - 표준 UTF-8: `00` (널 바이트) 
	    - 변형 UTF-8: `C0 80` 같은 형태로 저장해서 **바이트 00을 피함**
	2. **BMP 밖 문자(이모지 등)** 를 코드포인트로 인코딩 안함
	    - 표준 UTF-8: 코드 포인트를 그대로 보고 4바이트로 인코딩 => BMP 밖 문자 2바이트 + B
	    - 변형 UTF-8: UTF-16의 **서로게이트 2조각(char 2개)**을 각각 인코딩해서 **6바이트**가 됨
		    - 서로게이트: UTF-16에서 U+FFFF를 넘는 문자를 자바의 char(16비트) 2개로 쪼개 표현하는 방식
- 왜 변형을 만들었나?
	- C 계열에서 `00`을 문자열 끝으로 취급하는 관습 때문에 **널 바이트를 피하려고**
	- `.class` 파일/`writeUTF` 같은 포맷이 오래전에 굳어서 지금 바꾸면 **호환성 대참사**라 안 바꿈

### 자바에서 UTF-8 쓸 때 주의점
- 웹/JSON/파일/DB 같은 외부 환경과 통신은 **표준 UTF-8**을 써야함
- 아래 코드처럼 항상 **charset을 명시**
```java
byte[] bytes = text.getBytes(StandardCharsets.UTF_8);
String back = new String(bytes, StandardCharsets.UTF_8);
```
- `writeUTF/readUTF`는 **자바끼리 약속한 통신**에서만 안전(다른 언어랑 섞이면 깨질 수 있음)
	- 서버/클라이언트 둘 다 자바고 둘 다 `DataInputStream.readUTF()` / `DataOutputStream.writeUTF()`를 쓰기로 약속했으면 OK
	