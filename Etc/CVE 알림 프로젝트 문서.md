## 프로젝트 개요
- 정의: NVD CVE API에서 CVE 데이터를 수집해 신규/수정 변화를 감지하고, 알림 규칙에 따라 필터링된 항목만 선별해 알림을 생성·전달하는 서비스
- 목표: CVE 데이터를 수집하고, 변경 감지와 알림 규칙 평가로 중복 없이 알림을 생성·전달하는 운영형 백엔드 파이프라인을 익힌다.

## 목표
- CVE 데이터는 **마지막 성공 수집 시각 ~ 현재(몇 분 전)** 기간으로 조회해 수집하고 로컬DB에 저장한다
- 이번에 바뀐 CVE(신규/수정)를 규칙으로 검사해서 알림을 생성하고 저장한다.
- 재실행해도 결과가 흔들리지 않게(중복 없이) 만든다. 
- 문제 발생 시 추적할 수 있도록 **실행 이력**을 남긴다.

## 1차 MVP 범위
- 포함
	- CVE 데이터 수집
	- 수집 실행 이력 기록
	- 알림 규칙 로드
	- 알림 생성
	- 알림 생성 실행 이력 기록
	- 알림함 조회(저장된 알림 확인)
- 제외 (2,3차 개발 때 진행)
    - 웹 UI
    - 외부 채널 전송(Slack, 이메일 등)
    - 사용자 계정/권한

## 기능 요구사항 
### 1. CVE 데이터 수집
- 시스템은 조회 기간을 기준으로 CVE를 가져와 로컬에 저장할 수 있어야 한다.
	- 조회 기간(수집 기간) 정책
		- 시작: 마지막 수집 성공 수집의 끝 시각 
		- 끝: 현재 시각 
		- 최초 실행: 최근 24시간 (추후 옵션화)
		- 목적: 경계 누락 방지 + 지연 대비
- 동일 CVE 항목이 이미 로컬DB에 있으면, API 응답의 lastModified(마지막 수정 시각) 가 로컬DB 값보다 더 최신일 때만 업데이트한다. (같거나 과거면 업데이트하지 않음)
	- lastModified: CVE 항목이 마지막으로 수정된 시각(API가 제공하는 값)

### 2. 신규/수정 판정
- 수집한 CVE 항목은 로컬DB에 이미 있는지와 lastModified(마지막 수정 시각)을 비교해 신규 / 수정 / 변화없음 으로 구분할 수 있어야 한다.

### 3. 수집 실행 이력 기록
- 수집 실행마다 아래 정보를 남겨야 한다.
	- 수집 실행 ID (수집 실행을 구분하는 기준)
	- 상태(성공/실패/스킵)
	- 조회 기간(시작/끝 시각)
	- CVE 항목 건수(가져온 개수, 신규 개수, 수정 개수, 실패 개수)
	- 수집 시작/종료 시각
	- 실패 시 에러 요약
        
### 4. 규칙 로드
- 시스템은 미리 저장해둔 규칙 여러 개를 읽어 사용할 수 있어야 한다.
- 1차 MVP에서는 규칙을 새로 만들거나 수정하는 기능은 없다.
    
### 5. 알림 생성 
- 알림 생성은 마지막으로 알림 생성을 성공한 시각 이후의 CVE 항목을 대상으로 수행한다.
- 수집 실행마다 추가/수정된 CVE 항목 목록을 따로 저장하지 않기 때문에, 알림 대상은 아래 방식으로 정한다.
	- 시작 시각: 마지막 알림 성공 시각
	- 끝 시각: 마지막 수집 성공 시각
	- 대상 CVE: 로컬 CVE 중 lastModified가 위 기간 안에 있는 항목
	- 대상 CVE에 규칙을 적용해 알림을 생성한다.
        
### 6. 알림 중복 방지
- 알림 생성은 재실행해도 중복 생성되지 않아야 한다.
- 중복 판정 기준: 규칙 ID + CVE ID + lastModified

### 7. 알림 생성 실행 이력 기록
- 알림 생성 실행마다 아래 정보를 남겨야 한다.
	- 알림 생성 ID
	- 상태(성공/실패/스킵)
	- 대상 CVE 수(검사 수), 매칭 수, 생성 수, 중복으로 스킵된 수
	- 스킵 사유(예: 수집이 성공이 아님 / 대상 CVE가 0개)
	- 시작/종료 시각, 걸린 시간
	- 실패 시 에러 요약
        
### 8. 알림함 조회
- 저장된 알림을 목록으로 확인할 수 있어야 한다.
- 알림에는 최소한 아래가 포함되어야 한다.
    - CVE ID
    - NVD 웹사이트 링크 (해당 CVE ID의 상세 페이지)
    - 어떤 규칙으로 생성됐는지
    - 생성 시각

## 데모 시나리오
1. 수집 실행 API 호출
2. 서버가 조회할 기간 범위를 정하고, 그 범위로 CVE API를 조회
3. 조회한 CVE를 저장하고, 신규/수정 여부를 판정해 반영
4. 알림 생성 API 호출(수집 결과 기준)
5. 알림 규칙을 적용해 알림을 생성하고 알림함에 기록
6. 알림함 조회 API로 생성된 알림을 확인

## 기능 우선순위(1차 구현 순서)
1. CVE API 호출해서 데이터 저장 + lastModified 비교 업데이트
2. 수집 실행 이력 기록
3. 규칙 로드
4. 알림 생성 실행(마지막 알림 성공 시각 이후 ~ 마지막 수집 성공 시각 대상)
5. 규칙 적용 후 알림 생성/저장
6. 알림 생성 이력 기록
7. 알림함에서 확인


## 변경 이력
| 날짜         | 변경                  | 결정                                       | 보류             |     |
| ---------- | ------------------- | ---------------------------------------- | -------------- | --- |
| 2025-01-05 | 아이디어/기능 덤프 노트 작성    | - MVP 기능 목록 작성<br>- 데이터 수집/필터링 요구사항 표 작성 | - 1/2/3차 개발 사항 |     |
| 2026-01-06 | 덤프 노트를 프로젝트 문서로 재구성 | 수집과 알림 생성 분리, 실행 이력/알림함 중심               | - 의존도          |     |
|            |                     |                                          | - 2/3차 상세 개발사항 |     |
